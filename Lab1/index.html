<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Lexer Java </title>

   <style>body{white-space: pre-wrap;}</style>

</head>
<body><font color="#a7a6a7">/*
 * $Id: Kernel.java,v 1.23 2001/10/08 01:15:46 rayo Exp $
 * 456789012345678901234567890123456789012345678901234567890123456789012
 */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#202cc5">package</font><font color="#ffffff"> </font><font color="#8f0689">com</font><font color="#41b4d6">.</font><font color="#8f0689">knu</font><font color="#41b4d6">.</font><font color="#8f0689">ynortman</font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#202cc5">import</font><font color="#ffffff"> </font><font color="#8f0689">java</font><font color="#41b4d6">.</font><font color="#8f0689">util</font><font color="#41b4d6">.</font><font color="#8f0689">StringTokenizer</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#202cc5">import</font><font color="#ffffff"> </font><font color="#8f0689">java</font><font color="#41b4d6">.</font><font color="#8f0689">util</font><font color="#41b4d6">.</font><font color="#8f0689">Properties</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#202cc5">import</font><font color="#ffffff"> </font><font color="#8f0689">java</font><font color="#41b4d6">.</font><font color="#8f0689">io</font><font color="#41b4d6">.</font><font color="#8f0689">FileInputStream</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#202cc5">import</font><font color="#ffffff"> </font><font color="#8f0689">java</font><font color="#41b4d6">.</font><font color="#8f0689">io</font><font color="#41b4d6">.</font><font color="#8f0689">IOException</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#202cc5">import</font><font color="#ffffff"> </font><font color="#8f0689">java</font><font color="#41b4d6">.</font><font color="#8f0689">io</font><font color="#41b4d6">.</font><font color="#8f0689">FileNotFoundException</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#a7a6a7">/*
 * $Log: Kernel.java,v $
 * Revision 1.23  2001/10/08 01:15:46  rayo
 * modified directory entry to be more like dirent
 *
 * Revision 1.22  2001/10/07 23:48:55  rayo
 * added author javadoc tag
 *
 */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#a7a6a7">/**
 * Simulates a unix-like file system.  Provides basic directory
 * and file operations and implements them in terms of the underlying
 * disk block structures.
 * @author Ray Ontko
 */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">class</font><font color="#ffffff"> </font><font color="#8f0689">Kernel</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * The name this program uses when displaying any error messages 
   * it generates internally.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#116c2c">"Kernel"</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/* Errors */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Not owner.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EPERM</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * No such file or directory.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">ENOENT</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">2</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Bad file number.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EBADF</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">9</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Permission denied.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EACCES</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">13</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * File exists.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EEXIST</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">17</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Cross-device link.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EXDEV</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">18</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Not a directory.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">ENOTDIR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">20</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Is a directory.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EISDIR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">21</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Invalid argument.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EINVAL</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">22</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * File table overflow.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">ENFILE</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">23</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Too many open files.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EMFILE</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">24</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * File too large.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EFBIG</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">27</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * No space left on device.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">ENOSPC</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">28</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Read-only file system.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EROFS</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">30</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Too many links.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EMLINK</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">31</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Number of errors messages defined in sys_errlist
   * <p>
   * Simulates unix system variable:
   * <pre>
   *   int sys_nerr;
   * </pre>
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">sys_nerr</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">32</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * The array of kernel error messages.
   * <p>
   * Simulates unix system variable:
   * <pre>
   *   const char *sys_errlist[];
   * </pre>
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#41b4d6">[</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#8f0689">sys_errlist</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Not owner"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"No such file or directory"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Bad file number"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Permission denied"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"File exists"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Cross-device link"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Not a directory"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Is a directory"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Invalid argument"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"File table overflow"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Too many open files"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"File too large"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"No space left on device"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Read-only file system"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"Too many links"</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Prints a system error message.  The actual text written
   * to stderr is the
   * given string, followed by a colon, a space, the message
   * text, and a newline.  It is customary to give the name of
   * the program as the argument to perror.
   * @param s the program name
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">void</font><font color="#ffffff"> </font><font color="#8f0689">perror</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">s</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">message</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&&</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">sys_nerr</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">message</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">sys_errlist</font><font color="#41b4d6">[</font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">message</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">s</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#116c2c">": unknown errno "</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">s</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#116c2c">": "</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#8f0689">message</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Set the value of errno for the current process.
   * <p>
   * Simulates the unix variable:
   * <pre>
   *   extern int errno ;
   * </pre>
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">void</font><font color="#ffffff"> </font><font color="#8f0689">setErrno</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">newErrno</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": no current process in setErrno()"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">newErrno</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Get the value of errno for the current process.
   * <p>
   * Simulates the unix variable:
   * <pre>
   *   extern int errno ;
   * </pre>
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">getErrno</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": no current process in getErrno()"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/* Modes */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * File type mask
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMT</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#ff9e00">0170000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Regular file
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IFREG</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#ff9e00">0100000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Multiplexed block special
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMPB</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">070000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Block Special
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IFBLK</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">060000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Directory
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IFDIR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">040000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Multiplexed character special
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMPC</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">030000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Character special
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IFCHR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">020000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Set user id on execution
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_ISUID</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">04000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Set group id on execution
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_ISGID</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">02000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Save swapped text even after use
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_ISVTX</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">01000</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * User (file owner) has read, write and execute permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IRWXU</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0700</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * User has read permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IRUSR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0400</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * User has read permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IREAD</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0400</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * User has write permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IWUSR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0200</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * User has write permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IWRITE</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0200</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * User has execute permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IXUSR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0100</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * User has execute permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IEXEC</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0100</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Group has read, write and execute permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IRWXG</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">070</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Group has read permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IRGRP</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">040</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Group has write permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IWGRP</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">020</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Group has execute permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IXGRP</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">010</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Others have read, write and execute permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IRWXO</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">07</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Others have read permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IROTH</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">04</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Others have write permisson
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IWOTH</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">02</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Others have execute permission
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">S_IXOTH</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">01</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Closes the specified file descriptor.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int close(int fd);
   * </pre>
   * @param fd the file descriptor of the file to close
   * @return Zero if the file is closed; -1 if the file descriptor 
   * is invalid.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">close</font><font color="#41b4d6">(</font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check fd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// remove the file descriptor from the kernel's list of open files</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">for</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">MAX_OPEN_FILES</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">i</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">i</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? is it an error if we didn't find the open file?</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// remove the file descriptor from the list.</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Creates a file or directory with the specified mode.  
   * <p>
   * Creates a new file or prepares to rewrite an existing file.
   * If the file does not exist, it is given the mode specified.
   * If the file does exist, it is truncated to length zero.
   * The file is opened for writing and its file descriptor is 
   * returned.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int creat(const char *pathname, mode_t mode);
   * </pre>
   * @param pathname the name of the file or directory to create
   * @param mode the file or directory protection mode for the new file
   * @return the file descriptor (a non-negative integer); -1 if 
   * a needed directory is not searchable, if the file does not 
   * exist and the directory in which it is to be created is not 
   * writable, if the file does exist and is unwritable, if the 
   * file is a directory, or if there are already too many open 
   * files.
   * @exception java.lang.Exception if any underlying action causes
   * an exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">creat</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">mode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the full path</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">getFullPath</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">StringBuilder</font><font color="#ffffff"> </font><font color="#8f0689">dirname</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">StringBuilder</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"/"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">openFileSystems</font><font color="#41b4d6">[</font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">getRootIndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">prevIndexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">ROOT_INDEX_NODE_NUMBER</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">StringTokenizer</font><font color="#ffffff"> </font><font color="#8f0689">st</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">StringTokenizer</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"/"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#116c2c">"."</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#a7a6a7">// start at root node</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">while</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">st</font><font color="#41b4d6">.</font><font color="#8f0689">hasMoreTokens</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">st</font><font color="#41b4d6">.</font><font color="#8f0689">nextToken</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#0">!</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#41b4d6">.</font><font color="#8f0689">equals</font><font color="#41b4d6">(</font><font color="#116c2c">""</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if the current node is a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">getMode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMT</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">S_IFDIR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (ENOTDIR) if a needed directory is not a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOTDIR</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if it is readable by the user</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? tbd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EACCES) if a needed directory is not readable</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">st</font><font color="#41b4d6">.</font><font color="#8f0689">hasMoreTokens</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">dirname</font><font color="#41b4d6">.</font><font color="#8f0689">append</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">dirname</font><font color="#41b4d6">.</font><font color="#8f0689">append</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#13ff57">'/'</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the next inode corresponding to the token</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">prevIndexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">findNextIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">prevIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? we need to set some fields in the file descriptor</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">O_WRONLY</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#a7a6a7">// ???</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// file does not exist.  We check to see if we can create it.</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if the prevIndexNode (a directory) is writeable</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? tbd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EACCES) if the file does not exist and the directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// in which it is to be created is not writable</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">setMode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">mode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">setNlink</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// allocate the next available inode from the file system</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">newInode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">allocateIndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">newInode</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// assign inode for the new file</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">setIndexNodeNumber</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">newInode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#a7a6a7">// System.out.println( "newInode = " + newInode ) ;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">writeIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">newInode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// open the directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? it would be nice if we had an "open" that took an inode </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// instead of a name for the dir</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#a7a6a7">// System.out.println( "dirname = " + dirname.toString() ) ;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">open</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dirname</font><font color="#41b4d6">.</font><font color="#8f0689">toString</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">O_RDWR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">Kernel</font><font color="#41b4d6">.</font><font color="#8f0689">perror</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": unable to open directory for writing"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">Kernel</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? is this correct</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// scan past the directory entries less than the current entry</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// and insert the new element immediately following</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#ffffff"> </font><font color="#8f0689">newDirectoryEntry</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">newInode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#ffffff"> </font><font color="#8f0689">currentDirectoryEntry</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">while</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#d75ee5">true</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// read an entry from the directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">readdir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">currentDirectoryEntry</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": error reading directory in creat"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if no entry read, write the new item at the current </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// location and break</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">writedir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">newDirectoryEntry</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if current item > new item, write the new item in </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// place of the old one and break</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">currentDirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">getName</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#41b4d6">.</font><font color="#8f0689">compareTo</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">newDirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">getName</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">seek_status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">lseek</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">DIRECTORY_ENTRY_SIZE</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">seek_status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": error during seek in creat"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">writedir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">newDirectoryEntry</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// copy the rest of the directory entries out to the file</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">while</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#ffffff"> </font><font color="#8f0689">nextDirectoryEntry</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// read next item</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">readdir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">nextDirectoryEntry</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// in its place</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">seek_status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">lseek</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">DIRECTORY_ENTRY_SIZE</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">seek_status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": error during seek in creat"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write current item</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">writedir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">currentDirectoryEntry</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// current item = next item</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">currentDirectoryEntry</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">nextDirectoryEntry</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// close the directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">close</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// file does exist ( indexNodeNumber >= 0 )</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if it's a directory, we can't truncate it</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">getMode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMT</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#8f0689">S_IFDIR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EISDIR) if the file is a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">EISDIR</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if the file is writeable by the user</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? tbd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EACCES) if the file does exist and is unwritable</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// free any blocks currently allocated to the file</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">getBlockSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">blocks</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">getSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">for</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">blocks</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">address</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">getBlockAddress</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">address</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">NOT_A_BLOCK</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">freeBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">address</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">setBlockAddress</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">NOT_A_BLOCK</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// update the inode to size 0</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#41b4d6">.</font><font color="#8f0689">setSize</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write the inode to the file system.</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">writeIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// set up the file descriptor</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">currIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// assign inode for the new file</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">setIndexNodeNumber</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">open</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Terminate the current "process".  Any open files will be closed.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   exit(int status);
   * </pre>
   * <p>
   * Note: If this is the last process to terminate, this method
   * calls finalize().
   * @param status the exit status
   * @exception java.lang.Exception if any underlying 
   * Exception is thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">void</font><font color="#ffffff"> </font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// close anything that might be open for the current process</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">for</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">.</font><font color="#8f0689">length</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">i</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">close</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// terminate the process</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">processCount</font><font color="#ffffff"> </font><font color="#0">--</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if this is the last process to end, call finalize</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">processCount</font><font color="#ffffff"> </font><font color="#0"><=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">finalize</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Set the current file pointer for a file.
   * The current file position is updated based on the values of
   * offset and whence.  If whence is 0, the new position is 
   * offset bytes from the beginning of the file.  If whence is
   * 1, the new position is the current position plus the value 
   * of offset.  If whence is 2, the new position is the size
   * of the file plus the offset value.  Note that offset may be
   * negative if whence is 1 or 2, as long as the resulting 
   * position is not less than zero.  It is valid to position
   * past the end of the file, but it is not valid to read
   * past the end of the file.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   lseek( int filedes , int offset , int whence );
   * </pre>
   * @param fd the file descriptor
   * @param offset the offset
   * @param whence 0 = from beginning of file; 1 = from 
   * current position ; 2 = from end of file
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">lseek</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">whence</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check fd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">newOffset</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">whence</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">newOffset</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">whence</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">newOffset</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">whence</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">2</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">newOffset</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// bad whence value</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">EINVAL</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">newOffset</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// bad offset value</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">EINVAL</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setOffset</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">newOffset</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">newOffset</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/*
   * Open flags.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Open with read-only access.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">O_RDONLY</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Open with write-only access.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">O_WRONLY</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Open for read or write access.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">final</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">O_RDWR</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">2</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Opens a file or directory for reading, writing, or 
   * both reading and writing.
   * <p>
   * The file is positioned at the beginning (byte 0).
   * The returned file descriptor must be used for subsequent
   * calls for other input and output functions on the file.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int open(const char *pathname, int flags );
   * </pre>
   * @param pathname the name of the file or directory to create
   * @param flags the flags to use when opening the file: O_RDONLY,
   * O_WRONLY, or O_RDWR.
   * @return the file descriptor (a non-negative integer); -1 if 
   * the file does not exist, if one of the necessary directories 
   * does not exist or is unreadable, if the file is not readable 
   * (resp. writable), or if too many files are open.
   * @exception java.lang.Exception if any underlying action causes
   * an exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">open</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the full path name</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">getFullPath</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">findIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? return (Exxx) if the file is not readable </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// and was opened O_RDONLY or O_RDWR</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? return (Exxx) if the file is not writable </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// and was opened O_WRONLY or O_RDWR</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// set up the file descriptor</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">openFileSystems</font><font color="#41b4d6">[</font><font color="#ffffff"> </font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#ffffff"> </font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">setIndexNodeNumber</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">open</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Open a file using a FileDescriptor.  The open and create
   * methods build a file descriptor and then invoke this method
   * to complete the open process.
   * <p>
   * This is a convenience method for the simulator kernel.
   * @param fileDescriptor the file descriptor
   * @return the file descriptor index in the process open file 
   * list assigned to this open file
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">open</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// scan the kernel open file list for a slot </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// and add our new file descriptor</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">kfd</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">for</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">MAX_OPEN_FILES</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">i</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">kfd</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">kfd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">kfd</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (ENFILE) if there are already too many open files</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENFILE</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// scan the list of open files for a slot </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// and add our new file descriptor</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">for</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">ProcessContext</font><font color="#41b4d6">.</font><font color="#8f0689">MAX_OPEN_FILES</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">i</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// remove the file from the kernel list</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">kfd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EMFILE) if there isn't room left</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">EMFILE</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return the index of the file descriptor for now open file</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Read bytes from a file.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int read(int fd, void *buf, size_t count);
   * </pre>
   * @param fd the file descriptor of a file open for reading
   * @param buf an array of bytes into which bytes are read
   * @param count the number of bytes to read from the file
   * @return the number of bytes actually read; or -1 if an error occurs.
   * @exception java.lang.Exception if any underlying action causes
   * Exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">read</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">byte</font><font color="#41b4d6">[</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">count</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check fd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd_for_read</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">size</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBlockSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">byte</font><font color="#41b4d6">[</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#8f0689">bytes</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBytes</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">readCount</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">for</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">count</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if we read to the end of the file, stop reading</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">>=</font><font color="#ffffff"> </font><font color="#8f0689">size</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if this is the first time through the loop,</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// or if we're at the beginning of a block, load the data block</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">||</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">readBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// copy a byte from the file buffer to the read buffer</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">[</font><font color="#8f0689">i</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">bytes</font><font color="#41b4d6">[</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">readCount</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// update the offset</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setOffset</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return the count of bytes read</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">readCount</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Reads a directory entry from a file descriptor for an open directory.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int readdir(unsigned int fd, struct dirent *dirp ) ;
   * </pre>
   * Note that count is ignored in the unix call.
   * @param fd the file descriptor for the directory being read
   * @param dirp the directory entry into which data should be copied
   * @return number of bytes read; 0 if end of directory; -1 if the file
   * descriptor is invalid, or if the file is not opened for read access.
   * @exception java.lang.Exception if any underlying action causes
   * Exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">readdir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#ffffff"> </font><font color="#8f0689">dirp</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check fd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd_for_read</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if the file is a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getMode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMT</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">S_IFDIR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (ENOTDIR) if a needed directory is not a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOTDIR</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return 0 if at end of directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">>=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// read a block, if needed</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">readBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBlockSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// read bytes from the block into the DirectoryEntry</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">dirp</font><font color="#41b4d6">.</font><font color="#8f0689">read</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBytes</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBlockSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setOffset</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">DIRECTORY_ENTRY_SIZE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return the size of a DirectoryEntry</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">DIRECTORY_ENTRY_SIZE</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Obtain information for an open file.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int fstat(int filedes, struct stat *buf);
   * </pre>
   * @exception java.lang.Exception if any underlying action causes
   * Exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fstat</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">Stat</font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check fd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">deviceNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">getDeviceNumber</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">getIndexNodeNumber</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">getIndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// copy information to buf</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">.</font><font color="#8f0689">st_dev</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">deviceNumber</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">.</font><font color="#8f0689">st_ino</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">.</font><font color="#8f0689">copyIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Obtain information about a named file.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int stat(const char *name, struct stat *buf);
   * </pre>
   * @exception java.lang.Exception if any underlying action causes
   * Exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">stat</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">Stat</font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// a buffer for reading directory entries</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#ffffff"> </font><font color="#8f0689">directoryEntry</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the full path</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">path</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">getFullPath</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// find the index node</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">findIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">path</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return ENOENT</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOENT</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// copy information to buf</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">.</font><font color="#8f0689">st_dev</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">.</font><font color="#8f0689">st_ino</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">.</font><font color="#8f0689">copyIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * First commits inodes to buffers, and then buffers to disk.
   * <p>
   * Simulates unix system call:
   * <pre>
   *   int sync(void);
   * </pre>
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">void</font><font color="#ffffff"> </font><font color="#8f0689">sync</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write out superblock if updated</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write out free list blocks if updated</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write out inode blocks if updated</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write out data blocks if updated</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// at present, all changes to inodes, data blocks, </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// and free list blocks</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// are written as they go, so this method does nothing.</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Write bytes to a file.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int write(int fd, const void *buf, size_t count);
   * </pre>
   * @exception java.lang.Exception if any underlying action causes
   * Exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">write</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">byte</font><font color="#41b4d6">[</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">count</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check fd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd_for_write</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (ENOSPC) if the device containing the file system</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// referred to by fd has not room for the data</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">size</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBlockSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">byte</font><font color="#41b4d6">[</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#8f0689">bytes</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBytes</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">writeCount</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">for</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#8f0689">count</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if this is the first time through the loop,</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// or if we're at the beginning of a block, </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// load or allocate a data block</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">i</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">||</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">readBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// copy a byte from the write buffer to the file buffer</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">bytes</font><font color="#41b4d6">[</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">buf</font><font color="#41b4d6">[</font><font color="#8f0689">i</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if we get to the end of a block, write it out</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">writeBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// update the file size if it grew</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#8f0689">size</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setSize</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">size</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">writeCount</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write the last block if we wrote anything to it</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">writeBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// update the file size if it grew</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#8f0689">size</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setSize</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// update the offset</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setOffset</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">offset</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return the count of bytes written</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">writeCount</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Writes a directory entry from a file descriptor for an 
   * open directory.
   * <p>
   * Simulates the unix system call:
   * <pre>
   *   int readdir(unsigned int fd, struct dirent *dirp ) ;
   * </pre>
   * Note that count is ignored in the unix call.
   * @param fd the file descriptor for the directory being read
   * @param dirp the directory entry into which data should be copied
   * @return number of bytes read; 0 if end of directory; -1 if the file
   * descriptor is invalid, or if the file is not opened for read access.
   * @exception java.lang.Exception if any underlying action causes
   * Exception to be thrown
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">writedir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#ffffff"> </font><font color="#8f0689">dirp</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check fd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd_for_write</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if the file is a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getMode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMT</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">S_IFDIR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (ENOTDIR) if a needed directory is not a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOTDIR</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBlockSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// allocate or read a block</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">readBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write bytes from the DirectoryEntry into the block</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">dirp</font><font color="#41b4d6">.</font><font color="#8f0689">write</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getBytes</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">%</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// write the updated block</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">writeBlock</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#202cc5">short</font><font color="#41b4d6">)</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">/</font><font color="#ffffff"> </font><font color="#8f0689">blockSize</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// update the file size</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setOffset</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">DIRECTORY_ENTRY_SIZE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">></font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getSize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">setSize</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">file</font><font color="#41b4d6">.</font><font color="#8f0689">getOffset</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return the size of a DirectoryEntry</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">DIRECTORY_ENTRY_SIZE</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#a7a6a7">/*
to be done:
       int access(const char *pathname, int mode);
       int link(const char *oldpath, const char *newpath);
       int unlink(const char *pathname);
       int rename(const char *oldpath, const char *newpath);
       int symlink(const char *oldpath, const char *newpath);
       int lstat(const char *file_name, struct stat *buf);
       int chmod(const char *path, mode_t mode);
       int fchmod(int fildes, mode_t mode);
       int chown(const char *path, uid_t owner, gid_t group);
       int fchown(int fd, uid_t owner, gid_t group);
       int lchown(const char *path, uid_t owner, gid_t group);
       int utime(const char *filename, struct utimbuf *buf);
       int readlink(const char *path, char *buf, size_t bufsiz);
       int chdir(const char *path);
       mode_t umask(mode_t mask);
*/</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * This is an internal variable for the simulator which always 
   * points to the 
   * current ProcessContext.  If multiple processes are implemented,
   * then this variable will "point" to different processes at
   * different times.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#8f0689">ProcessContext</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * The number of processes.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">processCount</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">MAX_OPEN_FILES</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#41b4d6">[</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#8f0689">openFiles</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? should be private?</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">MAX_OPEN_FILE_SYSTEMS</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? should be private?</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#41b4d6">[</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#8f0689">openFileSystems</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#41b4d6">[</font><font color="#8f0689">MAX_OPEN_FILE_SYSTEMS</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? should be private?</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Initialize the file simulator kernel.  This should be the
   * first call in any simulation program.  You can think of this
   * as the method which "boots" the kernel.
   * This method opens the "filesys.conf" file (or the file named
   * by the system property "filesys.conf") and reads any properties
   * given in that file, including the filesystem.root.filename and
   * filesystem.root.mode ("r", "rw").
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">void</font><font color="#ffffff"> </font><font color="#8f0689">initialize</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if the name of an alternate configuration</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// file has been specified.  This can be done, for example,</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">//   java -Dfilesys.conf=myfile.txt program-name parameter ...</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">propertyFileName</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"filesys.conf"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">propertyFileName</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">propertyFileName</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#116c2c">"filesys.conf"</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">Properties</font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">Properties</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">try</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileInputStream</font><font color="#ffffff"> </font><font color="#8f0689">in</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileInputStream</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">propertyFileName</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">load</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">in</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">in</font><font color="#41b4d6">.</font><font color="#8f0689">close</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">FileNotFoundException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#116c2c">": error opening properties file"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">IOException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#116c2c">": error reading properties file"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the root file system properties</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">rootFileSystemFilename</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"filesystem.root.filename"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"filesys.dat"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">rootFileSystemMode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"filesystem.root.mode"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"rw"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the current process properties</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">uid</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">try</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">uid</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">Short</font><font color="#41b4d6">.</font><font color="#8f0689">parseShort</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"process.uid"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"1"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">NumberFormatException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": invalid number for property process.uid in configuration file"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">gid</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">try</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">gid</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">Short</font><font color="#41b4d6">.</font><font color="#8f0689">parseShort</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"process.gid"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"1"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">NumberFormatException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": invalid number for property process.gid in configuration file"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">umask</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0002</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">try</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">umask</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">Short</font><font color="#41b4d6">.</font><font color="#8f0689">parseShort</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"process.umask"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"002"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#ff9e00">8</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">NumberFormatException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": invalid number for property process.umask in configuration file"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#116c2c">"/root"</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"process.dir"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"/root"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">try</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">MAX_OPEN_FILES</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">Integer</font><font color="#41b4d6">.</font><font color="#8f0689">parseInt</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">"kernel.max_open_files"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"20"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">NumberFormatException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": invalid number for property kernel.max_open_files in configuration file"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">try</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">ProcessContext</font><font color="#41b4d6">.</font><font color="#8f0689">MAX_OPEN_FILES</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">Integer</font><font color="#41b4d6">.</font><font color="#8f0689">parseInt</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">properties</font><font color="#41b4d6">.</font><font color="#8f0689">getProperty</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"process.max_open_files"</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"10"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">NumberFormatException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#116c2c">": invalid number for property process.max_open_files in configuration file"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// create open file array</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">openFiles</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#41b4d6">[</font><font color="#8f0689">MAX_OPEN_FILES</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// create the first process</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">ProcessContext</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">uid</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">gid</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">dir</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">umask</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">processCount</font><font color="#ffffff"> </font><font color="#0">++</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// open the root file system</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">try</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">openFileSystems</font><font color="#41b4d6">[</font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">rootFileSystemFilename</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">rootFileSystemMode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">catch</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">IOException</font><font color="#ffffff"> </font><font color="#8f0689">e</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">err</font><font color="#41b4d6">.</font><font color="#8f0689">println</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">PROGRAM_NAME</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#116c2c">": unable to open root file system"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Failure exit status.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_FAILURE</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Success exit status.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">EXIT_SUCCESS</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * End the simulation and exit.
   * Terminates any remaining "processes", flushes all file system blocks
   * to "disk", and exit the simulation program.  This method is generally
   * called by exit() when the last process terminates.  However,
   * it may also be called directly to gracefully end the simlation.
   * @param status the status to use with System.exit() 
   * @exception java.lang.Exception if any underlying operation
   * causes and exception to be thrown.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">public</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">void</font><font color="#ffffff"> </font><font color="#8f0689">finalize</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// exit() any remaining processes</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// flush file system blocks</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">sync</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// close the root file system</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">openFileSystems</font><font color="#41b4d6">[</font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#41b4d6">]</font><font color="#41b4d6">.</font><font color="#8f0689">close</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// terminate the program</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">System</font><font color="#41b4d6">.</font><font color="#8f0689">exit</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#a7a6a7">/*
Some internal methods.
*/</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Check to see if the integer given is a valid file descriptor
   * index for the current process.  Sets errno to EBADF if invalid. 
   * <p>
   * This is a convenience method for the simulator kernel;
   * it should not be called by user programs.
   * @param fd the file descriptor index
   * @return zero if the file descriptor index is valid; -1 if the file
   * descriptor index is not valid
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">check_fd</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// look for the file descriptor in the open file list</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">||</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#0">>=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">.</font><font color="#8f0689">length</font><font color="#ffffff"> </font><font color="#41b4d6">||</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EBADF) if file descriptor is invalid</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">EBADF</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Check to see if the integer given is a valid file descriptor
   * index for the current process, and if so, whether the file is
   * open for reading.  Sets errno to EBADF if invalid or not open
   * for reading.
   * <p>
   * This is a convenience method for the simulator kernel;
   * it should not be called by user programs.
   * @param fd the file descriptor index
   * @return zero if the file descriptor index is valid; -1 if the file
   * descriptor index is not valid or is not open for reading.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">check_fd_for_read</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">getFlags</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">O_RDONLY</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&&</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">O_RDWR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EBADF) if the file is not open for reading</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">EBADF</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/**
   * Check to see if the integer given is a valid file descriptor
   * index for the current process, and if so, whether the file is
   * open for writing.  Sets errno to EBADF if invalid or not open
   * for writing.
   * <p>
   * This is a convenience method for the simulator kernel;
   * it should not be called by user programs.
   * @param fd the file descriptor index
   * @return zero if the file descriptor index is valid; -1 if the file
   * descriptor index is not valid or is not open for writing.
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">check_fd_for_write</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">check_fd</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">openFiles</font><font color="#41b4d6">[</font><font color="#8f0689">fd</font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#41b4d6">.</font><font color="#8f0689">getFlags</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">O_WRONLY</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&&</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">flags</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">O_RDWR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EBADF) if the file is not open for writing</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">EBADF</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">/** 
   * Get the full path for a file by adding
   * the working directory for the current process
   * to the beginning of the given path name
   * if necessary.
   * @param pathname the given path name
   * @return the resulting fully qualified path name
   */</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">getFullPath</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// make sure the path starts with a slash</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#41b4d6">.</font><font color="#8f0689">startsWith</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#116c2c">"/"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">else</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">getDir</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#116c2c">"/"</font><font color="#ffffff"> </font><font color="#0">+</font><font color="#ffffff"> </font><font color="#8f0689">pathname</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">fullPath</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">rootIndexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">getRootIndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">rootIndexNode</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#da7b7b">null</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">rootIndexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">openFileSystems</font><font color="#41b4d6">[</font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#41b4d6">]</font><font color="#41b4d6">.</font><font color="#8f0689">getRootIndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">rootIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">findNextIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">nextIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if stat isn't a directory give an error</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#41b4d6">.</font><font color="#8f0689">getMode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMT</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">S_IFDIR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (ENOTDIR) if a needed directory is not a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOTDIR</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if user isn't alowed to read directory, give an error</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? tbd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EACCES) if a needed directory is not readable</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">FileDescriptor</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">O_RDONLY</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">open</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fileDescriptor</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// process.errno = ???</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// create a buffer for reading directory entries</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#ffffff"> </font><font color="#8f0689">directoryEntry</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">DirectoryEntry</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// while there are more directory blocks to be read</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">while</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#d75ee5">true</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// read a directory entry</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">readdir</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">directoryEntry</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><=</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// we got to the end of the directory, or </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// encountered an error, so quit</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">directoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">getName</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#41b4d6">.</font><font color="#8f0689">equals</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">name</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">directoryEntry</font><font color="#41b4d6">.</font><font color="#8f0689">getIno</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// read the inode block</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">readIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">nextIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// we're done searching</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">break</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// close the file since we're done with it</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">int</font><font color="#ffffff"> </font><font color="#8f0689">close_status</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">close</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">fd</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">close_status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// process.errno = ???</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if we encountered an error reading, return error</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// process.errno = ???</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// if we got to the directory without finding the name, return error</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">status</font><font color="#ffffff"> </font><font color="#0">==</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOENT</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return index node number if success</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the inode for a file which is expected to exist</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">private</font><font color="#ffffff"> </font><font color="#202cc5">static</font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">findIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">path</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">inode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">throws</font><font color="#ffffff"> </font><font color="#8f0689">Exception</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// start with the root file system, root inode</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">openFileSystems</font><font color="#41b4d6">[</font><font color="#ffffff"> </font><font color="#8f0689">ROOT_FILE_SYSTEM</font><font color="#ffffff"> </font><font color="#41b4d6">]</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">getRootIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">short</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">FileSystem</font><font color="#41b4d6">.</font><font color="#8f0689">ROOT_INDEX_NODE_NUMBER</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// parse the path until we get to the end</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">StringTokenizer</font><font color="#ffffff"> </font><font color="#8f0689">st</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">StringTokenizer</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">path</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#116c2c">"/"</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">while</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">st</font><font color="#41b4d6">.</font><font color="#8f0689">hasMoreTokens</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">String</font><font color="#ffffff"> </font><font color="#8f0689">s</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">st</font><font color="#41b4d6">.</font><font color="#8f0689">nextToken</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#0">!</font><font color="#ffffff"> </font><font color="#8f0689">s</font><font color="#41b4d6">.</font><font color="#8f0689">equals</font><font color="#41b4d6">(</font><font color="#116c2c">""</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if it is a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#41b4d6">.</font><font color="#8f0689">getMode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">&</font><font color="#ffffff"> </font><font color="#8f0689">S_IFMT</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#0">!=</font><font color="#ffffff"> </font><font color="#8f0689">S_IFDIR</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (ENOTDIR) if a needed directory is not a directory</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOTDIR</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// check to see if it is readable by the user</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// ??? tbd</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return (EACCES) if a needed directory is not readable</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#ffffff"> </font><font color="#8f0689">nextIndexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#202cc5">new</font><font color="#ffffff"> </font><font color="#8f0689">IndexNode</font><font color="#41b4d6">(</font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// get the next index node corresponding to the token</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">findNextIndexNode</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">fileSystem</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">s</font><font color="#ffffff"> </font><font color="#41b4d6">,</font><font color="#ffffff"> </font><font color="#8f0689">nextIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">if</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#0"><</font><font color="#ffffff"> </font><font color="#ff9e00">0</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">{</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// return ENOENT</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">process</font><font color="#41b4d6">.</font><font color="#8f0689">errno</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">ENOENT</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#0">-</font><font color="#ff9e00">1</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#ffffff"> </font><font color="#0">=</font><font color="#ffffff"> </font><font color="#8f0689">nextIndexNode</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#a7a6a7">// copy indexNode to inode</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#8f0689">indexNode</font><font color="#41b4d6">.</font><font color="#8f0689">copy</font><font color="#41b4d6">(</font><font color="#ffffff"> </font><font color="#8f0689">inode</font><font color="#ffffff"> </font><font color="#41b4d6">)</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#202cc5">return</font><font color="#ffffff"> </font><font color="#8f0689">indexNodeNumber</font><font color="#ffffff"> </font><font color="#41b4d6">;</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font><font color="#ffffff"> </font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#41b4d6">}</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"></font><font color="#ffffff">
</font><font color="#ffffff"> </font></body>
</html>